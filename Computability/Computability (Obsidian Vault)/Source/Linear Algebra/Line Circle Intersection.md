Для нахождения точек пересечения между сферой и прямой, заданной двумя точками, можно решить совместно уравнение сферы и параметрическое уравнение прямой. Решение сводится к получению корней квадратного уравнения. Далее, подставляя эти корни в параметрическое уравнение, можно получить координаты точек пересечения. Если пара точек, по которым задана прямая, расположены друг от друга на расстоянии 1, то полученные параметры равны расстояниям до точек пересечения. 

# 2D

![[line_circle_intersection.png|wsmall center]]



Уравнение окружности, где $C$ – центр окружности

$$
(x-C_x)^2 + (y-C_y)^2 = r^2
$$

Параметрическое уравнение прямой, заданной по двум точкам $A$ и $B$:

$$
\begin{cases}
x = A_x + t(B_x - A_x) = A_x + tΔx \\[2mm]
y = A_y + t(B_x - A_y) = A_y + tΔy \\
\end{cases}
$$

Подставляя в уравнение окружности получаем квадратное уравнение 

$$
at^2 + bt + c = 0
$$

где

$$
\begin{aligned}
a &= Δx^2 + Δy^2 \\[2mm]
b &= 2 Δx(A_x - C_x) + 2 Δy(A_y - C_y) \\[2mm]
c &= (A_x - C_x)^2 + (A_y - C_y)^2 - r^2 \\[2mm]
\end{aligned}
$$

Если прямая является секущей, то уравнение даст два корня $t_1$ и $t_2$, соответствующей двум точкам пересечения прямой и окружности. Если прямая является касательной к окружности, то уравнение даст один корень $t$. Если же прямая не пересекается окружностью, то уравнение не будет иметь вещественных корней.

# 3D

В трёхмерном пространстве уравнение сферы с центром $C = (C_x, C_y, C_z)$ и радиусом $r$ выглядит так:

$$
(x-C_x)^2 + (y-C_y)^2 + (z-C_z)^2 = r^2
$$

Параметрическое уравнение прямой, заданной точками $A = (A_x, A_y, A_z)$ и $B = (B_x, B_y, B_z)$, имеет вид:

$$
\begin{cases}
x = A_x + t(B_x - A_x) = A_x + t\,\Delta x,\\[2mm]
y = A_y + t(B_y - A_y) = A_y + t\,\Delta y,\\[2mm]
z = A_z + t(B_z - A_z) = A_z + t\,\Delta z,
\end{cases}
$$

Подставим эти выражения в уравнение сферы, получим квадратное уравнение относительно $t$:

$$
a t^2 + b t + c = 0,
$$

где коэффициенты вычисляются следующим образом:

$$
\begin{aligned}
& a = \Delta x^2 + \Delta y^2 + \Delta z^2 \\[2mm]
& b = 2\left[\Delta x\,(A_x - C_x) + \Delta y\,(A_y - C_y) + \Delta z\,(A_z - C_z)\right] \\[2mm]
& c = (A_x - C_x)^2 + (A_y - C_y)^2 + (A_z - C_z)^2 - r^2
\end{aligned} \\[2mm]
$$

Очевидно, что вид выражений для коэффициентов $a, b, c$ один и тот же для двумерного и для трехмерного случая и легко обобщается на пространство произвольной размерности.

>[!code]
> Функция `compute_intersection_params()` может вычислять параметры пересечения прямой с гиперсферой в пространстве любой конечной размерности.
>  ```python
> def get_roots_of_quad_eq(a, b, c):
> 	D = b**2 - 4 * a * c
> 	if D < 0:
> 		return None    
> 	elif D == 0:
> 		root = -b / (2 * a)
> 		return root, root
> 	else:
> 	   return (-b + np.sqrt(D)) / (2 * a), (-b - np.sqrt(D)) / (2 * a)
> 
> def compute_intersection_params(A, B, C, r):
> 
> 	d = B - A                           # Вектор направления прямой
> 	
> 	a = np.dot(d, d)                    # a = ||d||^2
> 	b = 2 * np.dot(d, A - C)            # b = 2 * d • (A - C)
> 	c = np.dot(A - C, A - C) - r**2     # c = ||A - C||^2 - r^2
> 	
> 	roots = get_roots_of_quad_eq(a, b, c)
>     if roots is None:
>         return None
>     else:
>         return roots[0], roots[1]
> ```
> 
